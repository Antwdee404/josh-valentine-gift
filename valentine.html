<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heart Defender â™¥ A Valentine's Gift</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink-soft: #ffc6d9;
            --pink-medium: #ffb3d9;
            --pink-warm: #ff9ec4;
            --peach: #ffccb8;
            --cream: #fff5f0;
            --rose: #ff6b9d;
            --coral: #ff8fa3;
            --dark: #8b4567;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(135deg, var(--pink-soft) 0%, var(--peach) 50%, var(--pink-medium) 100%);
            touch-action: none;
            user-select: none;
            image-rendering: pixelated;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸŒ¸ WHITE FLOWERS FALLING ON START SCREEN
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #start-flowers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 101; /* Above UI layer background, below content */
            overflow: hidden;
        }

        .white-flower {
            position: absolute;
            font-size: 45px; /* Bigger for better visibility */
            animation: fallFlower linear infinite;
            opacity: 0;
            filter: drop-shadow(0 3px 8px rgba(255, 255, 255, 1)) 
                    drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
            /* Strong white glow so they pop against pink */
        }

        @keyframes fallFlower {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 1; /* Full opacity for visibility */
            }
            95% {
                opacity: 1; /* Stay visible longer */
            }
            100% {
                transform: translateY(calc(100vh + 50px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* ğŸ’• PINK HEARTS BACKGROUND (DURING GAMEPLAY) */
        #hearts-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.4;
            display: none;
        }

        .floating-heart {
            position: absolute;
            font-size: 30px;
            animation: floatUp linear infinite;
            opacity: 0.6;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) scale(0.8);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) scale(1.2);
                opacity: 0;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ® START SCREEN - ABSOLUTELY CENTERED
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #ui-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            background: linear-gradient(135deg, rgba(255, 198, 217, 0.7) 0%, rgba(255, 204, 184, 0.7) 100%);
            /* Reduced opacity from 0.95 to 0.7 so flowers show through better */
        }

        #ui-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 90%;
            max-width: 600px;
            z-index: 102; /* Above flowers */
        }

        h1 { 
            color: var(--rose);
            text-shadow: 
                3px 3px 0 var(--cream),
                5px 5px 15px rgba(255, 107, 157, 0.4);
            line-height: 1.8; 
            font-size: 20px;
            margin-bottom: 30px;
            animation: gentlePulse 3s ease-in-out infinite;
        }

        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .subtitle {
            font-size: 16px;
            color: var(--dark);
            margin: 20px 0;
            opacity: 0.9;
        }

        .emoji-decor {
            font-size: 40px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, var(--rose) 0%, var(--coral) 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 
                0 8px 25px rgba(255, 107, 157, 0.5),
                inset 0 -2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            animation: gentleBounce 2s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes gentleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        button:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 30px rgba(255, 107, 157, 0.6),
                inset 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 
                0 4px 15px rgba(255, 107, 157, 0.4),
                inset 0 -1px 5px rgba(0, 0, 0, 0.1);
        }

        #rotate-msg { display: block; }
        #start-container { display: none; }

        @media (orientation: landscape) {
            #rotate-msg { display: none; }
            #start-container { display: block; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ’— HEART WIPE TRANSITION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #heart-wipe {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            transform: translate(-50%, -50%);
            z-index: 150;
            pointer-events: none;
            display: none;
        }

        #heart-wipe.active {
            display: block;
            animation: heartExpand 1.5s ease-out forwards;
        }

        /* Heart shape using CSS */
        .heart-shape {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--rose);
        }

        .heart-shape:before,
        .heart-shape:after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--rose);
            border-radius: 50%;
        }

        .heart-shape:before {
            top: -50%;
            left: 0;
        }

        .heart-shape:after {
            left: 50%;
            top: -50%;
        }

        @keyframes heartExpand {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(30);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(30);
                opacity: 0;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ¯ GAME CONTAINER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #game-container {
            display: none;
            position: relative;
            width: 100vw;
            height: 100vh;
            box-shadow: 
                inset 0 0 50px rgba(255, 255, 255, 0.5),
                inset 0 0 100px rgba(255, 182, 193, 0.3);
            background: linear-gradient(135deg, 
                rgba(255, 245, 240, 0.3) 0%, 
                rgba(255, 198, 217, 0.3) 100%);
        }

        canvas { 
            display: block; 
            width: 100%; 
            height: 100%; 
            image-rendering: pixelated;
            border-radius: 8px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“Š HUD WITH 4 HEARTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #score-board {
            position: absolute;
            top: 20px; 
            left: 20px;
            color: white;
            font-size: 11px;
            text-shadow: 2px 2px 8px rgba(139, 69, 103, 0.8);
            z-index: 10;
            padding: 12px 18px;
            background: linear-gradient(135deg, 
                rgba(255, 107, 157, 0.8) 0%, 
                rgba(255, 143, 163, 0.8) 100%);
            border-radius: 20px;
            border: 3px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 4px 15px rgba(255, 107, 157, 0.4),
                inset 0 2px 10px rgba(255, 255, 255, 0.3);
        }

        #health-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 26px;
            z-index: 10;
            display: flex;
            gap: 6px;
            filter: drop-shadow(2px 2px 4px rgba(139, 69, 103, 0.5));
        }

        .health-heart {
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        .health-heart:nth-child(2) {
            animation-delay: 0.15s;
        }

        .health-heart:nth-child(3) {
            animation-delay: 0.3s;
        }

        .health-heart:nth-child(4) {
            animation-delay: 0.45s;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            10% { transform: scale(1.15); }
            20% { transform: scale(1); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“¸ PHOTO CARD
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #memory-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(139, 69, 103, 0.95);
            backdrop-filter: blur(10px);
            z-index: 200;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        #memory-card {
            position: relative;
            background: var(--cream);
            padding: 15px;
            text-align: center;
            max-width: 75%;
            border-radius: 8px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            transform: rotate(-2deg);
            animation: cardPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes cardPop {
            0% { 
                transform: rotate(-2deg) scale(0.3);
                opacity: 0;
            }
            70% {
                transform: rotate(-2deg) scale(1.05);
            }
            100% { 
                transform: rotate(-2deg) scale(1);
                opacity: 1;
            }
        }

        #memory-img {
            width: 100%;
            height: auto;
            max-height: 50vh;
            display: block;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        #memory-text {
            color: var(--dark);
            font-size: 11px;
            margin-top: 15px;
            padding: 10px;
            line-height: 1.6;
        }

        .tap-hint {
            font-size: 8px;
            color: #999;
            margin-top: 12px;
            cursor: pointer;
        }

        .photo-decor {
            position: absolute;
            font-size: 24px;
            opacity: 0.6;
            animation: float 3s ease-in-out infinite;
        }

        .photo-decor.tl { top: -20px; left: -20px; }
        .photo-decor.tr { top: -20px; right: -20px; }
        .photo-decor.bl { bottom: -20px; left: -20px; }
        .photo-decor.br { bottom: -20px; right: -20px; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ¬ FINALE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #finale-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, 
                #1a0008 0%, 
                #3d0015 50%,
                #1a0008 100%);
            z-index: 300;
            color: var(--pink-soft);
            text-align: center;
            overflow-y: scroll;
            padding-top: 100vh;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        #finale-screen::-webkit-scrollbar {
            display: none;
        }

        .scrolling-content {
            animation: credits 28s linear forwards;
            padding-bottom: 50vh;
        }
        
        @keyframes credits {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        .scrolling-content h1 {
            font-size: 26px;
            margin: 50px 0;
            color: var(--rose);
            text-shadow: 
                0 0 20px rgba(255, 107, 157, 0.6),
                3px 3px 0 var(--pink-warm);
        }

        .scrolling-content p {
            font-size: 14px;
            line-height: 2.2;
            margin: 35px 25px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        #finale-gallery {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            margin: 40px 0;
        }

        #finale-gallery img {
            width: 220px;
            border-radius: 12px;
            border: 8px solid var(--cream);
            box-shadow: 
                0 15px 40px rgba(255, 107, 157, 0.4),
                0 0 0 2px var(--rose);
            transition: transform 0.3s ease;
        }

        #finale-gallery img:hover {
            transform: scale(1.05) rotate(2deg);
        }

    </style>
</head>
<body>

    <!-- ğŸµ AUDIO -->
    <audio id="bgm" loop>
        <source src="assets/luther.mp3" type="audio/mpeg">
    </audio>

    <!-- ğŸŒ¸ WHITE FLOWERS (START SCREEN) -->
    <div id="start-flowers"></div>

    <!-- ğŸ’• PINK HEARTS (GAMEPLAY) -->
    <div id="hearts-bg"></div>

    <!-- ğŸ’— HEART WIPE TRANSITION -->
    <div id="heart-wipe">
        <div class="heart-shape"></div>
    </div>

    <!-- ğŸ® START SCREEN -->
    <div id="ui-layer">
        <div id="ui-content">
            <div id="rotate-msg">
                <div class="emoji-decor">ğŸ’</div>
                <h1>PLAYER 1<br><br>PLEASE ROTATE<br>YOUR PHONE</h1>
                <div class="emoji-decor">ğŸ”„ğŸ“±</div>
            </div>
            
            <div id="start-container">
                <div class="emoji-decor">ğŸ’Œ</div>
                <h1>ğŸ¥° GENEVIEVE DEFENDER ğŸ¥°</h1>
                <div class="subtitle">A Gift For You</div>
                <button id="start-btn" onclick="startGame()">â™¥ START â™¥</button>
                <div class="emoji-decor">ğŸŒ¸ ğŸ’• ğŸŒ¸</div>
            </div>
        </div>
    </div>

    <!-- ğŸ¯ GAME SCREEN -->
    <div id="game-container">
        <div id="score-board">â¤ï¸ SCORE: 0</div>
        <div id="health-bar">
            <span class="health-heart">ğŸ’—</span>
            <span class="health-heart">ğŸ’—</span>
            <span class="health-heart">ğŸ’—</span>
            <span class="health-heart">ğŸ’—</span>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- ğŸ“¸ MEMORY REVEAL -->
    <div id="memory-overlay" onclick="closeMemory()">
        <div id="memory-card" onclick="event.stopPropagation()">
            <div class="photo-decor tl">ğŸ’•</div>
            <div class="photo-decor tr">ğŸ’•</div>
            <div class="photo-decor bl">ğŸŒ¸</div>
            <div class="photo-decor br">ğŸŒ¸</div>
            <img id="memory-img" src="" alt="Memory">
            <div id="memory-text"></div>
            <div class="tap-hint">(Tap anywhere to Continue ğŸ’•)</div>
        </div>
    </div>

    <!-- ğŸ¬ FINALE CREDITS -->
    <div id="finale-screen">
        <div class="scrolling-content">
            <div style="font-size: 60px; margin-bottom: 30px;">ğŸ’</div>
            <h1>â™¥ HAPPY VALENTINE'S DAY â™¥</h1>
            <br><br>
            <p>You defended my heart.</p>
            <br>
            <p>Thank you for being my Player 1.</p>
            <br>
            <p>Every moment with you is a gift.</p>
            <br>
            <p style="font-size: 18px; color: var(--rose);">I love you.</p>
            <br><br>
            <div style="font-size: 40px; margin: 30px 0;">ğŸ’• ğŸŒ¸ ğŸ’— ğŸŒ¸ ğŸ’•</div>
            <br>
            <div id="finale-gallery"></div>
            <br><br><br>
            <div style="font-size: 30px;">ğŸ’Œ</div>
            <p style="font-size: 10px; color: #888;">Made with â™¥ in 2025</p>
            <p>THE END</p>
            <br><br>
            <div style="font-size: 40px;">ğŸŒ¸</div>
            <br><br>
        </div>
    </div>

    <script>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ® HEART DEFENDER - COMPLETE GAME
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        const YOUR_MEMORIES = [
            { 
                score: 150,
                text: "Happy Valentine's Day ğŸ’•", 
                img: "assets/photo1.png" 
            },
            { 
                score: 350,
                text: "I love You ğŸ¥°", 
                img: "assets/photo2.png" 
            },
            { 
                score: 600,
                text: "My One true love ğŸ˜Š", 
                img: "assets/photo3.png" 
            }
        ];
        
        const WINNING_SCORE = 800;

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ¨ PIXEL ART SPRITES
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function drawGardenia(ctx, x, y, size) {
            const pixelSize = size / 8;
            
            const pattern = [
                [0,0,1,1,1,1,0,0],
                [0,1,1,1,1,1,1,0],
                [1,1,1,2,2,1,1,1],
                [1,1,2,2,2,2,1,1],
                [1,1,2,2,2,2,1,1],
                [1,1,1,2,2,1,1,1],
                [0,1,1,1,1,1,1,0],
                [0,0,1,1,1,1,0,0]
            ];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    if (pattern[row][col] === 1) {
                        ctx.fillStyle = '#ffffff';
                    } else if (pattern[row][col] === 2) {
                        ctx.fillStyle = '#ffeb3b';
                    } else {
                        continue;
                    }
                    ctx.fillRect(x + col * pixelSize, y + row * pixelSize, pixelSize, pixelSize);
                }
            }
        }

        function drawBrokenHeart(ctx, x, y, size) {
            const pixelSize = size / 8;
            
            const pattern = [
                [0,1,1,0,0,1,1,0],
                [1,1,1,1,1,1,1,1],
                [1,1,1,1,1,1,1,1],
                [1,1,1,0,0,1,1,1],
                [0,1,1,1,1,1,1,0],
                [0,0,1,1,1,1,0,0],
                [0,0,0,1,1,0,0,0],
                [0,0,0,0,0,0,0,0]
            ];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    if (pattern[row][col]) {
                        ctx.fillStyle = '#8b4567';
                        ctx.fillRect(x + col * pixelSize, y + row * pixelSize, pixelSize, pixelSize);
                    }
                }
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ® GAME STATE
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameRunning = false;
        let score = 0;
        let health = 4; // âœ¨ NOW 4 HEARTS!
        let lastTime = 0;
        let nextMemoryIndex = 0;

        const player = { 
            x: 0, 
            y: 0, 
            w: 32,
            h: 32
        };
        
        let bullets = [];
        let enemies = [];
        let particles = [];
        
        let enemyTimer = 0;
        let bulletTimer = 0;

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ¬ INITIALIZATION
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // ğŸŒ¸ Create white flowers for start screen
        function createStartFlowers() {
            const container = document.getElementById('start-flowers');
            const flowers = ['ğŸŒ¸', 'ğŸ¤', 'ğŸŒ¼', 'ğŸŒº', 'ğŸ’®', 'ğŸµï¸'];
            
            for (let i = 0; i < 30; i++) {
                const flower = document.createElement('div');
                flower.className = 'white-flower';
                flower.innerText = flowers[Math.floor(Math.random() * flowers.length)];
                flower.style.left = Math.random() * 100 + '%';
                flower.style.animationDuration = (Math.random() * 8 + 10) + 's';
                flower.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(flower);
            }
        }
        createStartFlowers();

        // ğŸ’• Create pink hearts for gameplay
        function createFloatingHearts() {
            const container = document.getElementById('hearts-bg');
            const hearts = ['ğŸ’•', 'ğŸ’—', 'ğŸ’–', 'ğŸ’', 'ğŸŒ¸'];
            
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerText = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 8 + 12) + 's';
                heart.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(heart);
            }
        }
        createFloatingHearts();

        function startGame() {
            // ğŸ’— Trigger heart wipe effect
            const heartWipe = document.getElementById('heart-wipe');
            heartWipe.classList.add('active');
            
            // ğŸµ Start music
            document.getElementById('bgm').play().catch(e => console.log('ğŸµ Audio:', e));
            
            // â±ï¸ Wait for heart wipe animation
            setTimeout(() => {
                // Hide start screen and white flowers
                document.getElementById('ui-layer').style.display = 'none';
                document.getElementById('start-flowers').style.display = 'none';
                
                // Show game and pink hearts
                document.getElementById('game-container').style.display = 'block';
                document.getElementById('hearts-bg').style.display = 'block';
                
                // Reset heart wipe
                heartWipe.classList.remove('active');
                
                resize();
                player.x = canvas.width / 2 - player.w / 2;
                player.y = canvas.height - 80;
                
                gameRunning = true;
                lastTime = performance.now();
                requestAnimationFrame(gameLoop);
            }, 1000); // Wait for heart to expand
        }

        function resize() {
            canvas.width = document.getElementById('game-container').offsetWidth;
            canvas.height = document.getElementById('game-container').offsetHeight;
            player.y = canvas.height - 80;
            player.x = Math.max(0, Math.min(canvas.width - player.w, player.x));
        }
        window.addEventListener('resize', resize);

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ® CONTROLS
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touchX = e.touches[0].clientX - rect.left;
            const scaledX = (touchX / rect.width) * canvas.width;
            player.x = Math.max(0, Math.min(canvas.width - player.w, scaledX - player.w / 2));
        }, { passive: false });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const scaledX = (mouseX / rect.width) * canvas.width;
            player.x = Math.max(0, Math.min(canvas.width - player.w, scaledX - player.w / 2));
        });

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ’¥ PARTICLE SYSTEM
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function createExplosion(x, y) {
            const colors = ['#ff6b9d', '#ff8fa3', '#ffc6d9', '#ffb3d9'];
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 5,
                    vy: (Math.random() - 0.5) * 5 - 2,
                    life: 40,
                    color: colors[Math.floor(Math.random() * colors.length)]
                });
            }
        }

        function updateParticles() {
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.15;
                p.life--;
                
                ctx.globalAlpha = p.life / 40;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
                ctx.globalAlpha = 1.0;
                
                if (p.life <= 0) {
                    particles.splice(index, 1);
                }
            });
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ” MAIN GAME LOOP
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            /* â”€â”€â”€ PLAYER â”€â”€â”€ */
            drawGardenia(ctx, player.x, player.y, player.w);

            /* â”€â”€â”€ DUAL BULLETS (TWO BEAMS!) â”€â”€â”€ */
            bulletTimer += deltaTime;
            if (bulletTimer > 350) {
                // Left beam
                bullets.push({ 
                    x: player.x + 8,
                    y: player.y, 
                    active: true 
                });
                // Right beam
                bullets.push({ 
                    x: player.x + player.w - 8,
                    y: player.y, 
                    active: true 
                });
                bulletTimer = 0;
            }

            bullets.forEach(b => {
                b.y -= 8;
                
                // Gradient love beam
                const gradient = ctx.createLinearGradient(b.x, b.y, b.x, b.y + 16);
                gradient.addColorStop(0, '#ff6b9d');
                gradient.addColorStop(1, '#ff8fa3');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(b.x - 3, b.y, 6, 16);
                
                // White sparkle
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(b.x - 1, b.y + 2, 2, 12);
                
                if (b.y < -20) b.active = false;
            });
            bullets = bullets.filter(b => b.active);

            /* â”€â”€â”€ ENEMIES â”€â”€â”€ */
            enemyTimer += deltaTime;
            const spawnRate = 1000;
            
            if (enemyTimer > spawnRate) {
                enemies.push({ 
                    x: Math.random() * (canvas.width - 40), 
                    y: -40, 
                    speed: 2,
                    active: true 
                });
                enemyTimer = 0;
            }

            enemies.forEach(e => {
                e.y += e.speed;
                drawBrokenHeart(ctx, e.x, e.y, 32);
                
                if (e.y > canvas.height) {
                    e.active = false;
                    takeDamage();
                }
            });

            /* â”€â”€â”€ COLLISION â”€â”€â”€ */
            bullets.forEach(b => {
                enemies.forEach(e => {
                    if (b.active && e.active &&
                        b.x > e.x && b.x < e.x + 32 && 
                        b.y < e.y + 32 && b.y > e.y) {
                        
                        e.active = false;
                        b.active = false;
                        score += 10;
                        
                        createExplosion(e.x + 16, e.y + 16);
                        
                        document.getElementById('score-board').innerText = "â¤ï¸ SCORE: " + score;
                        checkMilestones();
                    }
                });
            });
            
            enemies = enemies.filter(e => e.active);

            /* â”€â”€â”€ PARTICLES â”€â”€â”€ */
            updateParticles();

            requestAnimationFrame(gameLoop);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           â¤ï¸ HEALTH SYSTEM (4 HEARTS)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function takeDamage() {
            health--;
            updateHealthDisplay();
            
            ctx.fillStyle = 'rgba(255, 143, 163, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (health <= 0) {
                gameOver();
            }
        }

        function updateHealthDisplay() {
            const hearts = ['ğŸ’—', 'ğŸ’—', 'ğŸ’—', 'ğŸ’—'];
            const healthBar = document.getElementById('health-bar');
            healthBar.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const heart = document.createElement('span');
                heart.className = 'health-heart';
                heart.innerText = i < health ? 'ğŸ’—' : 'ğŸ–¤';
                healthBar.appendChild(heart);
            }
        }

        function gameOver() {
            gameRunning = false;
            
            ctx.fillStyle = 'rgba(139, 69, 103, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = '18px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 40);
            ctx.font = '12px "Press Start 2P"';
            ctx.fillText('Score: ' + score, canvas.width / 2, canvas.height / 2);
            ctx.fillText('ğŸ’• Tap to retry ğŸ’•', canvas.width / 2, canvas.height / 2 + 40);
            
            canvas.addEventListener('click', restartGame, { once: true });
        }

        function restartGame() {
            score = 0;
            health = 4; // Reset to 4 hearts
            nextMemoryIndex = 0;
            bullets = [];
            enemies = [];
            particles = [];
            
            document.getElementById('score-board').innerText = 'â¤ï¸ SCORE: 0';
            updateHealthDisplay();
            
            player.x = canvas.width / 2 - player.w / 2;
            player.y = canvas.height - 80;
            
            gameRunning = true;
            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ“¸ MEMORY REVEAL
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function checkMilestones() {
            if (score >= WINNING_SCORE) {
                triggerFinale();
                return;
            }

            if (nextMemoryIndex < YOUR_MEMORIES.length) {
                if (score >= YOUR_MEMORIES[nextMemoryIndex].score) {
                    showMemory(YOUR_MEMORIES[nextMemoryIndex]);
                    nextMemoryIndex++;
                }
            }
        }

        function showMemory(memory) {
            gameRunning = false;
            
            const overlay = document.getElementById('memory-overlay');
            const img = document.getElementById('memory-img');
            const txt = document.getElementById('memory-text');
            
            img.src = memory.img;
            txt.innerText = memory.text;
            overlay.style.display = 'flex';
        }

        function closeMemory() {
            document.getElementById('memory-overlay').style.display = 'none';
            gameRunning = true;
            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ğŸ¬ FINALE
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        function triggerFinale() {
            gameRunning = false;
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('hearts-bg').style.display = 'none';
            
            const finale = document.getElementById('finale-screen');
            const gallery = document.getElementById('finale-gallery');
            
            YOUR_MEMORIES.forEach(mem => {
                const img = document.createElement('img');
                img.src = mem.img;
                img.alt = mem.text;
                gallery.appendChild(img);
            });

            finale.style.display = 'block';
            
            const bgm = document.getElementById('bgm');
            let volume = 1.0;
            const fadeOut = setInterval(() => {
                if (volume > 0.05) {
                    volume -= 0.05;
                    bgm.volume = volume;
                } else {
                    clearInterval(fadeOut);
                }
            }, 600);
        }

    </script>
</body>
</html>